# Внешняя сортировка
Сортировка данных, которые расположены на внешних устройствах и не вмещаются в оперативную память.
## Сортировка слиянием
1. Простое слияние
2. Естественное слияние

## Основные определения
- Серия - последовательность элементов, которая упорядочена по ключу.
- Длина серии - количество элементов в серии. Серия из одного элемента упорядочена.
- Слияние - процесс объединения двух или более упорядоченных серий в одну упорядоченную последовательность при помощи циклического выбора элементов.
- Фаза - действие по однократной обработке всей последовательности элементов.
- Двухфазная сортировка - сортировка, в которой реализуются две фазы: распределение и слияние.
- Однофазная сортировка - объединены фазы распределения и слияния в одну.
- Блок - минимальная единица данных, которая читается или записывается на внешнее устройство. Обычно размер блока определяется характеристиками устройства хранения.
- Буфер - область памяти, используемая для временного хранения данных, которые читаются из внешнего устройства или записываются на него. Буферы помогают уменьшить количество операций ввода-вывода.
- Промежуточный файл - файл, используемый для хранения данных на промежуточных этапах сортировки. Промежуточные файлы создаются и используются в процессе сортировки для хранения временных результатов.
- Многопутевая сортировка - метод внешней сортировки, при котором используется более двух вспомогательных файлов для распределения и слияния данных. Это может повысить эффективность сортировки за счет уменьшения числа фаз слияния.
- Внутренняя сортировка - сортировка данных, которые полностью помещаются в оперативную память. Внутренняя сортировка используется на этапах внешней сортировки, когда данные считываются в память для обработки.
- Внешняя память - устройства хранения данных, такие как жесткие диски, SSD, оптические диски и т.д., которые используются для хранения данных, не помещающихся в оперативную память.
- Ключ сортировки - поле или набор полей в записи, по которым определяется порядок сортировки. Ключ сортировки используется для сравнения и упорядочивания записей.
- Потоковая обработка - метод обработки данных, при котором данные обрабатываются по мере их поступления, без необходимости полного считывания всего набора данных в память. Потоковая обработка часто используется в контексте внешней сортировки для обработки больших объемов данных.

## Общий алгоритм двухпутевой сортировки
- Имеется посл. файл $A$, состоящий из записей $a{_1}, a{_2}, ..., a{_n}$
- Для сортировки используется два вспомогательных файла $B$ и $C$
- Разделите файл $A$ на две части, записывая чередующиеся записи в файлы $B$ и $C$
- Повторяйте следующие шаги до тех пор, пока все записи не будут отсортированы:
  1. Считайте и объедините отсортированные серии из файлов $B$ и $C$ обратно в файл $A$
  2. Разделите файл $A$ на две части, записывая чередующиеся серии в файлы $B$ и $C$
- Когда все записи будут отсортированы, объедините их в один файл $A$

## Алгоритм на C
```c
#include <stdio.h>
#include <stdlib.h>

void merge(FILE *input1, FILE *input2, FILE *output) {
    int a, b;
    int readA = fscanf(input1, "%d", &a);
    int readB = fscanf(input2, "%d", &b);

    while (readA == 1 && readB == 1) {
        if (a <= b) {
            fprintf(output, "%d ", a);
            readA = fscanf(input1, "%d", &a);
        } else {
            fprintf(output, "%d ", b);
            readB = fscanf(input2, "%d", &b);
        }
    }

    while (readA == 1) {
        fprintf(output, "%d ", a);
        readA = fscanf(input1, "%d", &a);
    }

    while (readB == 1) {
        fprintf(output, "%d ", b);
        readB = fscanf(input2, "%d", &b);
    }
}

void split(FILE *input, FILE *output1, FILE *output2) {
    int value;
    int toggle = 0;

    while (fscanf(input, "%d", &value) == 1) {
        if (toggle) {
            fprintf(output1, "%d ", value);
        } else {
            fprintf(output2, "%d ", value);
        }
        toggle = !toggle;
    }
}

void two_way_merge_sort(const char *inputFile, const char *outputFile) {
    FILE *input = fopen(inputFile, "r");
    FILE *temp1 = fopen("temp1.txt", "w+");
    FILE *temp2 = fopen("temp2.txt", "w+");

    if (!input || !temp1 || !temp2) {
        printf("Error opening files.\n");
        return;
    }

    split(input, temp1, temp2);
    fclose(input);

    FILE *output = fopen(outputFile, "w");
    if (!output) {
        printf("Error opening output file.\n");
        return;
    }

    rewind(temp1);
    rewind(temp2);
    merge(temp1, temp2, output);

    fclose(temp1);
    fclose(temp2);
    fclose(output);
}

int main() {
    const char *inputFile = "data/gen_input.txt";
    const char *outputFile = "data/output.txt";

    two_way_merge_sort(inputFile, outputFile);

    return 0;
}
```