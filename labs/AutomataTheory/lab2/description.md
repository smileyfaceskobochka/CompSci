# Анализ стратегий КНБ бота

## Общая архитектура бота  

Бот реализует **адаптивную стратегию** с двумя частями:  

1. **Многоуровневый анализ** для предсказания хода противника  
2. **Две стратегии ответа** с переключением при серии поражений  

---

## Система предсказания (5 уровней)  

Бот использует **строгую иерархию анализа** — **поочерёдно**, от высшего приоритета к низшему.  
**Как только один уровень дал результат — он используется. Остальные игнорируются.**

### Порядок выбора предсказания

1. **Пробует уровень 1** → если есть результат → **использует его**  
2. Если **-1** → пробует **уровень 2**  
3. Если **-1** → уровень 3  
4. Если **-1** → уровень 4  
5. Если **-1** → уровень 5 (резервный цикл)  

**Гарантированно всегда есть прогноз.**

---

### 1. Анализ совместных действий  

- **Что анализирует**: Последовательности **наших ходов + ходов противника**  
- **Как работает**: Ищет точное совпадение пар (мой ход → ход противника) длиной 2–10  
- **Результат**: Следующий ход противника после найденного паттерна  
- **Приоритет**: **Высший**  

### 2. Анализ реакции на результат  

- **Что анализирует**: **Результат предыдущего раунда**  
- **Как работает**:  
  - Если **противник выиграл** → ожидает **повтор хода**  
  - Если **противник проиграл** → ожидает **смену хода** (контр-ход)  
- **Результат**: Повтор или контр-ход  
- **Приоритет**: **2-й**  

### 3. Анализ повторений противника  

- **Что анализирует**: Только **ходы противника**  
- **Как работает**: Ищет повторяющиеся цепочки длиной 2–10  
- **Результат**: Следующий ход в найденной цепочке  
- **Приоритет**: **3-й**  

### 4. Анализ частоты  

- **Что анализирует**: **Частоту ходов противника** за последние 20 раундов  
- **Как работает**:  
  - Присваивает веса: новые ходы важнее (0.5 → 1.5)  
  - Выбирает **самую частую фигуру**  
- **Результат**: Самая частая фигура  
- **Приоритет**: **4-й**  

### 5. Резервный цикл  

- **Что анализирует**: **Длину истории**  
- **Как работает**: `(длина_истории % 3) + 1`  
- **Результат**:  
  - `0 → К`  
  - `1 → Б`  
  - `2 → Н`  
- **Приоритет**: **Последний** (только если всё выше не сработало)  

---

## Две стратегии ответа  

### Стратегия 1: Обычный ответ  

- **Как играет**: Всегда **контр-ход** к предсказанному  
- **Анти-повтор**:  
  - Если **3 одинаковых хода подряд** + **2 поражения подряд** → **циклическая смена** (К→Б→Н→К)  
  - Работает **внутри стратегии 1**, не требует переключения  
- **Пример**: Прогноз К → Б, но если Б-Б-Б + П-П → играет **Н** вместо Б  

### Стратегия 2: Изменённый ответ  

- **Как играет**: Цикл из 10 ходов  
- **1–6**: Контр-ход  
- **7–8**: Тот же ход (агрессивно)  
- **9–10**: Фиксированная  

**Фиксированная (9–10):**  

```txt
Н Н Б К Н К Б Н Б Б
```

---

## Переключение стратегий  
>
> **ТОЛЬКО после 5 поражений подряд — и никак иначе.**  

- Счётчик растёт при **П**  
- При **5 П подряд** → смена стратегии  
- При **В или Н** → сброс счётчика  
- **Других условий нет**  

---

## Результаты тестирования (50 раундов) с точными комментариями

| №  | МХ | ХС | Рез | Комментарий |
|----|----|----|-----|-------------|
| 1  | Б  | К  | в   | **Фиксированный старт: Бумага** |
| 2  | Н  | Б  | в   | **Прогноз: Б (по частоте: 1 К)** → контр → Н |
| 3  | К  | Н  | в   | **Прогноз: Н (по частоте: 1 Б)** → контр → К |
| 4  | Б  | К  | в   | **Прогноз: К (по частоте: 2 К)** → контр → Б |
| 5  | Н  | Б  | в   | **Прогноз: Б (по частоте: 2 Б)** → контр → Н |
| 6  | К  | Н  | в   | **Прогноз: Н (по частоте: 2 Н)** → контр → К |
| 7  | Б  | К  | в   | **Прогноз: К (по частоте: 3 К)** → контр → Б |
| 8  | Н  | Б  | в   | **Прогноз: Б (по частоте: 3 Б)** → контр → Н |
| 9  | К  | Н  | в   | **Прогноз: Н (по частоте: 3 Н)** → контр → К |
| 10 | Б  | К  | в   | **Прогноз: К (по частоте: 4 К)** → контр → Б |
| 11 | Б  | К  | в   | **Прогноз: К (по частоте: 5 К)** → контр → Б |
| 12 | Б  | К  | в   | **Прогноз: К (по частоте: 6 К)** → контр → Б |
| 13 | Б  | К  | в   | **Прогноз: К (по частоте: 7 К)** → контр → Б |
| 14 | Б  | Б  | н   | **Прогноз: К (по частоте: 7 К)** → контр → Б → ничья |
| 15 | Б  | Б  | н   | **Прогноз: К (по частоте: 7 К)** → контр → Б → ничья |
| 16 | Б  | Н  | п   | **Прогноз: К (по частоте: 7 К)** → контр → Б → поражение |
| 17 | Н  | Н  | н   | **Прогноз: К (по частоте: 7 К)** → контр → Б, но **анти-повтор (Б-Б-Б + П-П) → Н** → ничья |
| 18 | Б  | К  | в   | **Прогноз: К (по частоте: 8 К)** → контр → Б |
| 19 | Н  | К  | п   | **Прогноз: К (по частоте: 9 К)** → контр → Н → поражение |
| 20 | Б  | Б  | н   | **Прогноз: К (по частоте: 9 К)** → контр → Б → ничья |
| 21 | Н  | Б  | в   | **Прогноз: Б (по частоте: 9 К, 7 Б)** → контр → Н |
| 22 | К  | Б  | п   | **Прогноз: Б (по частоте: 9 К, 8 Б)** → контр → К → поражение |
| 23 | Н  | Н  | н   | **Прогноз: Б (по частоте: 9 К, 8 Б)** → контр → Н → ничья |
| 24 | К  | К  | н   | **Прогноз: К (по частоте: 10 К)** → контр → К → ничья |
| 25 | Н  | Б  | в   | **Прогноз: К (по частоте: 10 К)** → контр → Н |
| 26 | К  | Н  | в   | **Прогноз: К (по частоте: 10 К)** → контр → К |
| 27 | Н  | К  | п   | **Прогноз: К (по частоте: 11 К)** → контр → Н → поражение |
| 28 | К  | Б  | п   | **Прогноз: К (по частоте: 11 К)** → контр → К → поражение |
| 29 | Б  | Н  | п   | **Прогноз: К (по частоте: 11 К)** → контр → Б → поражение (**1/5**) |
| 30 | К  | К  | н   | **Прогноз: К (по частоте: 12 К)** → контр → К → ничья → сброс счётчика |
| 31 | Б  | Н  | п   | **Прогноз: К (по частоте: 12 К)** → контр → Б → поражение (**1/5**) |
| 32 | К  | Н  | в   | **Прогноз: К (по частоте: 12 К)** → контр → К → победа |
| 33 | Б  | Н  | п   | **Прогноз: К (по частоте: 12 К)** → контр → Б → поражение (**1/5**) |
| 34 | К  | Н  | в   | **Прогноз: К (по частоте: 12 К)** → контр → К → победа |
| 35 | К  | Н  | в   | **Прогноз: К (по частоте: 12 К)** → контр → К → победа |
| 36 | К  | К  | н   | **Прогноз: К (по частоте: 13 К)** → контр → К → ничья |
| 37 | К  | Б  | п   | **Прогноз: К (по частоте: 13 К)** → контр → К → поражение |
| 38 | К  | Н  | в   | **Прогноз: К (по частоте: 13 К)** → контр → К → победа |
| 39 | Н  | К  | п   | **Прогноз: К (по частоте: 14 К)** → контр → Н → поражение |
| 40 | К  | Б  | п   | **Прогноз: К (по частоте: 14 К)** → контр → К → поражение |
| 41 | Н  | К  | п   | **Прогноз: К (по частоте: 14 К)** → контр → Н → поражение (**1/5**) |
| 42 | Б  | К  | в   | **Прогноз: К (по частоте: 15 К)** → контр → Б |
| 43 | Н  | Б  | в   | **Прогноз: К (по частоте: 15 К)** → контр → Н |
| 44 | К  | Б  | п   | **Прогноз: К (по частоте: 15 К)** → контр → К → поражение |
| 45 | Б  | Н  | п   | **Прогноз: К (по частоте: 15 К)** → контр → Б → поражение (**1/5**) |
| 46 | К  | Н  | в   | **Прогноз: К (по частоте: 15 К)** → контр → К → победа |
| 47 | Б  | К  | в   | **Прогноз: К (по частоте: 16 К)** → контр → Б |
| 48 | Б  | К  | в   | **Прогноз: К (по частоте: 17 К)** → контр → Б |
| 49 | Н  | Б  | в   | **Прогноз: К (по частоте: 17 К)** → контр → Н |
| 50 | К  | Б  | п   | **Прогноз: К (по частоте: 17 К)** → контр → К → поражение |

---

## Ключевые наблюдения

| Пункт | Результат |
|------|----------|
| **Смена стратегии** | **НЕТ** — не было 5 поражений подряд |
| **Анти-повтор сработал** | **1 раз** (раунд 17): Б-Б-Б + П-П → сыграл Н вместо Б |
| **Прогноз по частоте** | Доминирует (К — 17 раз) |
| **Стратегия 1** | Работает весь тест |
| **Итог** | **27 побед, 8 ничьих, 15 поражений** → **54.0% побед** |
