# Описание бота для игры "Камень-Ножницы-Бумага"

## Основные правила и понятия

### Игровые элементы

- **Возможные ходы**: Камень, Бумага, Ножницы
- **Результаты раундов**: Победа, Поражение, Ничья
- **Принцип побед**: Камень побеждает Ножницы, Бумага побеждает Камень, Ножницы побеждают Бумагу
- **Контр-стратегия**: Для каждого хода противника существует единственный выигрышный ответный ход

### Система хранения данных

Бот ведет учет последних 1000 раундов, сохраняя:

- Последовательность ходов противника
- Собственные выбранные ходы
- Результаты каждого раунда (победа/поражение/ничья)

## Принцип работы системы принятия решений

### Инициализация и первый ход

При первом обращении система инициализируется и всегда выбирает бумагу. Это создает базовую точку отсчета для дальнейшего анализа.

### Алгоритм принятия решений для последующих ходов

1. **Запись данных**: Система сохраняет последний ход противника в историю
2. **Анализ результатов**: Вычисляется результат предыдущего раунда
3. **Проверка эффективности**: При серии из 5 поражений подряд система готовится к смене стратегии
4. **Предсказание**: На основе выбранной стратегии прогнозируется следующий ход противника
5. **Выбор ответа**: Определяется оптимальный контр-ход
6. **Обновление данных**: Сохранение собственного хода для будущего анализа

**Особенность**: Если система не может сделать достоверный прогноз (недостаточно данных), она по умолчанию выбирает бумагу.

## Стратегии анализа

### Общая концепция стратегий

Система использует два различных подхода к анализу поведения противника, которые активируются в зависимости от текущей ситуации. Значения тактики: 1 - анализ паттернов, 2 - частотный анализ.

### Стратегия поиска повторяющихся последовательностей

**Основная идея**: Поиск в истории игр паттернов - повторяющихся последовательностей ходов, которые могут указывать на предсказуемое поведение противника.

**Условия применения**: Требуется минимум 3 хода в истории для проведения анализа.

**Процесс анализа**:

1. **Определение длины поиска**: Система анализирует последовательности различной длины, начиная с самых длинных (базово до 10 ходов, при динамической адаптации до 12) и постепенно переходя к коротким (от 2 ходов)
2. **Поиск совпадений**: Для каждой длины последовательности система:
   - Берет последние несколько ходов как образец для поиска
   - Ищет идентичные последовательности в более ранней истории
   - Если находит совпадение и после него есть ходы, фиксирует следующий ход как потенциальное предсказание
3. **Оценка найденных паттернов**: Каждый обнаруженный паттерн получает оценку на основе:
   - Длины паттерна (более длинные последовательности ценятся выше)
   - Результатов последующих 1-3 ходов (если после паттерна были победы - паттерн получает положительную оценку, если поражения - отрицательную)
   - Текущего уровня адаптивности системы

**Формула оценки паттерна**:

- Базовый вес паттерна = 1.0
- Бонус за длину = длина × 0.5 × уровень_адаптации
- Итоговый вес = базовый_вес + бонус_за_длину
- Бонус за результаты (для каждого из 1-3 последующих раундов):
  - Победа: +(25 × уровень_адаптации + 15)
  - Ничья: +(12 × уровень_адаптации + 8)
  - Поражение: -(12 × уровень_адаптации + 8)
- Итоговая оценка = бонус_за_результаты × итоговый_вес

**Выбор оптимального паттерна**:

- Система выбирает паттерн с наивысшей оценкой
- Если оценка превышает порог (15 × уровень_адаптации + 10), что составляет 14.5-25 при уровне адаптации 0.3-1.0, паттерн используется немедленно
- В противном случае поиск продолжается среди более коротких последовательностей

### Стратегия частотного анализа с весовой системой

**Основная идея**: Анализ статистической частоты ходов противника с учетом временных факторов и результативности предыдущих раундов.

**Условия применения**: Требуется минимум 2 хода в истории.

**Размер окна анализа**: Базово 80 раундов, динамически изменяется от 60 до 120 раундов в зависимости от эффективности.

**Принцип взвешивания**:
Система не просто подсчитывает частоты, а применяет систему весов, где каждый ход получает определенное значение в зависимости от:

- **Возраста данных**: Более свежие ходы имеют больший вес
- **Результативности**: Вес хода изменяется в зависимости от того, выиграл или проиграл бот в следующем раунде
- **Недавности**: Особое усиление получают последние 10 ходов

**Детали системы весов**:

- **Базовый вес**: Рассчитывается линейно на основе позиции хода в окне анализа:
  - возрастной_фактор = (позиция_в_окне) / размер_окна
  - базовый_вес = 0.1 + возрастной_фактор × 0.9
  - Диапазон базового веса: от 0.1 (самые старые) до 1.0 (самые новые)
- **Усиление свежих данных**: Последние 10 ходов получают тройной вес (×3.0)
- **Модификация по результатам** (при уровне адаптации 0.3-1.0):
  - После поражения вес увеличивается в 3.2-6.0 раз (формула: ×(4.0 × уровень_адаптации + 2.0))
  - После победы вес уменьшается в 0.36-0.5 раза (формула: ×(0.2 × уровень_адаптации + 0.3))
  - После ничьи вес изменяется умеренно в 1.01-1.5 раза (формула: ×(0.7 × уровень_адаптации + 0.8))

**Выбор хода**: Система суммирует веса для каждого типа хода (Камень, Бумага, Ножницы) и выбирает ход с наибольшим суммарным весом. При равенстве показателей предпочтение отдается бумаге.

### Механизм переключения стратегий

**Триггер для смены стратегии**: Серия из 5 поражений подряд служит сигналом для смены подхода к анализу.

**Принцип работы**:

- При каждом поражении счетчик неудачных раундов увеличивается
- При достижении или превышении порога в 5 поражений система полностью меняет стратегию анализа
- Счетчик сбрасывается после смены стратегии
- При победе или ничьей счетчик также сбрасывается

## Адаптивная настройка параметров

### Концепция самонастройки

Система периодически анализирует свою общую эффективность и корректирует внутренние параметры для оптимизации результатов. Это происходит через вызов функции `setParameters`.

### Параметры эффективности

**Коэффициент побед**: Рассчитывается как отношение количества побед к общему числу сыгранных раундов.

### Уровень адаптации

Ключевой параметр системы, влияющий на все веса и коэффициенты. Диапазон значений: 0.3-1.0. Базовое значение при инициализации: 0.5.

### Режимы адаптации

**Агрессивный режим** (при коэффициенте побед выше 60%):

- Повышается уровень адаптации (увеличение на 0.1, максимум 1.0)
- Увеличивается максимальная длина анализируемых последовательностей (увеличение на 1, максимум 12)
- Расширяется окно анализа для учета большего количества исторических данных (увеличение на 10, максимум 120)

**Консервативный режим** (при коэффициенте побед ниже 40%):

- Понижается уровень адаптации для большей стабильности (уменьшение на 0.1, минимум 0.3)
- Уменьшается длина анализируемых последовательностей для поиска более очевидных паттернов (уменьшение на 1, минимум 6)
- Сужается окно анализа для фокуса на недавних данных (уменьшение на 10, минимум 60)

**Стабилизационный режим** (после 20 серий игры):

- Постепенное снижение уровня адаптации (уменьшение на 0.05, минимум 0.4) для предотвращения излишних колебаний
- Достижение оптимального баланса между адаптивностью и стабильностью

## Практические примеры работы системы

### Обозначения для примеров

- **Ходы**: К=Камень, Б=Бумага, Н=Ножницы
- **Результаты**: п=победа, пр=поражение, н=ничья

### Пример 1: Анализ повторяющихся последовательностей

**Сценарий тестирования**: Противник играет строго повторяющийся цикл "Камень-Бумага-Ножницы-Камень-Бумага-Ножницы..."

**Исходные настройки системы**: Используется стратегия поиска паттернов (тактика = 1), средний уровень адаптации (0.5), базовая длина поиска паттернов (10 ходов)

| Раунд | Ход противника | Прогноз системы | Наш ответ | Результат | Объяснение логики |
| ----- | -------------- | --------------- | --------- | --------- | ----------------- |
| 1     | -              | -               | Б         | -         | Начальная инициализация, всегда выбираем бумагу |
| 2     | К              | -               | Б         | п         | Недостаточно данных для анализа паттернов (нужно минимум 3), используем бумагу по умолчанию. Бумага побеждает камень |
| 3     | Б              | -               | Б         | н         | Все еще недостаточно данных (только 2 хода), бумага против бумаги - ничья |
| 4     | Н              | -               | Б         | пр        | Минимум данных достигнут (3 хода), но паттерн [К,Б] слишком короткий для надежного прогноза. По умолчанию бумага, но ножницы побеждают бумагу |
| 5     | К              | Б               | Н         | п         | Найдена последовательность [Б,Н] длиной 2, после которой ранее шел К. Прогнозируется бумага, отвечаем ножницами. Ножницы побеждают камень |
| 6     | Б              | Н               | К         | пр        | Найдена последовательность [Н,К] длиной 2, прогнозируются ножницы, отвечаем камнем. Бумага побеждает камень |
| 7     | Н              | К               | Б         | п         | Найдена последовательность [К,Б] длиной 2, прогнозируется камень, отвечаем бумагой. Бумага побеждает ножницы |
| 8     | К              | Б               | Н         | п         | Паттерн [Б,Н] подтверждается с положительной оценкой (после него была победа в раунде 5), прогнозируется бумага, отвечаем ножницами. Ножницы побеждают камень |
| 9     | Б              | Н               | К         | пр        | Последовательность [Н,К] с оценкой (учитывается поражение в раунде 6), прогнозируются ножницы, отвечаем камнем. Бумага побеждает камень |
| 10    | Н              | К               | Б         | п         | Обнаружена более длинная последовательность [К,Б,Н,К,Б,Н] длиной 6 с высокой оценкой, прогнозируется камень, отвечаем бумагой. Бумага побеждает ножницы |

### Пример 2: Частотный анализ с весовой системой

**Сценарий тестирования**: После серии из 5 поражений система переключилась на стратегию частотного анализа (тактика = 2). Противник играет преимущественно камнем, но затем переходит на бумагу.

**Исходные настройки**: Активна стратегия частотного анализа, средний уровень адаптации (0.5), окно анализа 80 раундов

История перед переключением: 5 поражений подряд привели к смене стратегии на частотный анализ.

| Раунд | Ход противника | Распределение частот | Прогноз | Наш ответ | Результат | Объяснение |
| ----- | -------------- | -------------------- | ------- | --------- | --------- | ---------- |
| 6     | К              | Камень доминирует    | К       | Б         | п         | История: преимущественно камни. Все веса сосредоточены на камне (усиление после поражений × 3.2-6.0). Прогноз - камень, отвечаем бумагой. Бумага побеждает камень |
| 7     | К              | Камень доминирует    | К       | Б         | п         | Продолжение серии камней, веса последних ходов утроены (×3.0). Прогноз - камень, бумага побеждает камень |
| 8     | Б              | Камень > Бумага > Ножницы | К   | Б         | н         | Камни остаются в большинстве, но появилась бумага с меньшим весом. Прогноз - камень, отвечаем бумагой. Равные ходы - ничья |
| 9     | Б              | Камень ≈ Бумага      | Б       | Н         | п         | Камни (старые, низкий вес после побед × 0.36-0.5) против бумаги (новые, утроенный вес × 3.0, после ничьи × 1.01-1.5). Бумага растет в оценке, прогноз - бумага, отвечаем ножницами. Ножницы побеждают бумагу |
| 10    | Б              | Бумага > Камень > Ножницы | Б   | Н         | п         | Бумага доминирует в последних ходах с высоким весом (×3.0 за свежесть). Прогноз - бумага, отвечаем ножницами. Ножницы побеждают бумагу |
| 11    | Н              | Бумага > Ножницы > Камень | Б   | Н         | н         | Бумага лидирует (утроенный вес × 3.0), ножницы единично. Прогноз - бумага, отвечаем ножницами. Равные ходы - ничья |
| 12    | Б              | Бумага сильно доминирует | Б   | Н         | п         | Серия бумаг, вес немного снижен после победы (× 0.36-0.5), но объем компенсирует. Прогноз - бумага, отвечаем ножницами. Ножницы побеждают бумагу |
| 13    | Б              | Бумага явно доминирует | Б    | Н         | п         | Бумага явно преобладает в последних ходах. Прогноз - бумага, отвечаем ножницами. Ножницы побеждают бумагу |
| 14    | К              | Бумага > Ножницы > Камень | Б   | Н         | пр        | Бумага все еще лидирует по весам (свежие данные + объем). Прогноз - бумага, отвечаем ножницами. Камень побеждает ножницы |
| 15    | Н              | Бумага > Ножницы > Камень | Б   | Н         | н         | Бумага сохраняет лидерство (свежие данные × 3.0 + общий объем). Прогноз - бумага, отвечаем ножницами. Равные ходы - ничья |

## Схема алгоритма

<img src="pics/flowchart.png" alt="Описание" width="95%">
